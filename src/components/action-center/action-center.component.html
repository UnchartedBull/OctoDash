<div class="wrapper" [ngClass]="{ visible: visible, editing: editing }">
  <div class="custom-actions" cdkDropList (cdkDropListDropped)="reorderAction($event)">
    <div
      class="custom-actions__action"
      *ngFor="let customAction of customActions; index as i"
      [attr.disabled]="!printerConnected && !customAction.command.startsWith('[!')"
      [style.border-color]="customAction.color"
      (click)="editing ? (editingAction = i) : doAction(customAction.command, customAction.exit, customAction.confirm)"
      matRipple
      [matRippleUnbounded]="false"
      cdkDrag
      [cdkDragDisabled]="!editing">
      <fa-icon
        [icon]="customAction.icon"
        class="custom-actions__action-icon"
        [style.color]="customAction.color"></fa-icon>
    </div>

    <div
      class="custom-actions__action custom-actions__action-add"
      *ngIf="editing"
      (click)="addAction()"
      matRipple
      [matRippleUnbounded]="false">
      <fa-icon icon="plus" class="custom-actions__action-icon"></fa-icon>
    </div>
  </div>

  <fa-icon
    icon="pencil"
    matRipple
    [matRippleUnbounded]="true"
    [matRippleCentered]="true"
    class="edit__icon"
    (click)="editing = !editing; editingAction = -1"></fa-icon>
</div>

<div class="iframe" id="iframe" *ngIf="iframeOpen">
  <span i18n="@@website-loading">loading website...</span>
  <iframe
    class="iframe__content"
    [src]="iframeURL | url"
    onerror="doActionConfirm()"
    allow="fullscreen; camera;"></iframe>
  <fa-icon icon="xmark" class="iframe__close" (click)="hideIframe()" />
</div>

<div class="confirm__wrapper" *ngIf="actionToConfirm">
  <div class="confirm">
    <h1 i18n="@@are-you-sure">are you sure?</h1>
    <p class="confirm__sub-heading" i18n="@@confirm-exec">do you want to execute the following command?</p>
    <p class="confirm__gcode">{{ actionToConfirm.command }}</p>
    <fa-icon
      icon="circle-check"
      class="confirm__icon confirm__icon-yes"
      (click)="doAction(actionToConfirm.command, actionToConfirm.exit, false)" />
    <fa-icon icon="circle-xmark" class="confirm__icon confirm__icon-no" (click)="hideConfirm()" />
  </div>
</div>

<div class="edit-panel" *ngIf="editingAction > -1">
  <div class="edit-panel__container">
    <label for="action-command" class="edit-panel__input-label" i18n="@@octodash-gcode">GCode / Action</label>
    <input
      type="string"
      id="action-command"
      class="edit-panel__input"
      name="action-command"
      style="width: 44.94vw; margin-bottom: -2vh"
      [(ngModel)]="customActions[editingAction].command"
      required />
    <table>
      <tr>
        <td>
          <label for="action-icon" class="edit-panel__input-label" i18n="@@action-icon">Icon</label>
          <input
            type="text"
            id="action-icon"
            class="edit-panel__input"
            name="action-icon"
            style="width: 14vw"
            [(ngModel)]="customActions[editingAction].icon"
            required />
        </td>
        <td style="padding-left: 3vw">
          <label for="action-color" class="edit-panel__input-label" i18n="@@action-color">Color</label>
          <input
            type="text"
            id="action-color"
            class="edit-panel__input"
            name="action-color"
            style="width: 14vw"
            [(ngModel)]="customActions[editingAction].color"
            required />
        </td>
        <td>
          <fa-icon
            [icon]="customActions[editingAction].icon"
            class="edit-panel__custom-action-icon"
            [style.color]="customActions[editingAction].color"></fa-icon>
        </td>
      </tr>
      <tr>
        <td>
          <div
            class="edit-panel__checkbox-container"
            (click)="customActions[editingAction].confirm = !customActions[editingAction].confirm">
            <span class="edit-panel__checkbox">
              <span class="edit-panel__checkbox-checked" *ngIf="customActions[editingAction].confirm"></span>
            </span>
            <span class="edit-panel__checkbox-descriptor" i18n="@@action-confirm">Confirm</span>
          </div>
        </td>

        <td style="padding-left: 3vw" colspan="2">
          <div
            class="edit-panel__checkbox-container"
            (click)="customActions[editingAction].exit = !customActions[editingAction].exit">
            <span class="edit-panel__checkbox">
              <span class="edit-panel__checkbox-checked" *ngIf="customActions[editingAction].exit"></span>
            </span>
            <span class="edit-panel__checkbox-descriptor" i18n="@@action-home">Return to Home</span>
          </div>
        </td>
      </tr>
    </table>

    <p class="edit-panel__attribution" i18n="@@octodash-custom-icon-attribution">
      Icons come from FontAwesome's free Classic Solid pack
    </p>

    <br />
    <p class="edit-panel__delete" (click)="deleteAction(editingAction); editingAction = -1" i18n="@@ui-delete">
      delete
    </p>
    <p class="edit-panel__close" (click)="updateActionsInConfig(); editingAction = -1" i18n="@@ui-close">close</p>
  </div>
</div>

<fa-icon
  icon="caret-left"
  (click)="visible = !visible; editing = false; editingAction = -1"
  matRipple
  [matRippleUnbounded]="true"
  [matRippleCentered]="true"
  class="toggle__icon"
  [ngClass]="{ visible: visible }"></fa-icon>
